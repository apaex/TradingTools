"use strict";window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,i=(this.document||this.ownerDocument).querySelectorAll(e),o=this;do{for(t=i.length;0<=--t&&i.item(t)!==o;);}while(t<0&&(o=o.parentElement));return o});var FinamHeader=function(i){var m=this;this.init=function(e){this.inited=!0,this.container=e,this.mobileContainer=document.querySelector(".fhr_mobile"),this.desktopContainer=document.querySelector(".fhr_desktop"),this.staticaPath=i.path,this.filialsList=void 0,this.filialsUrl=i.filialsUrl||"https://www.finam.ru/api/filials",this.nearestUrl=i.nearestUrl||"https://www.finam.ru/about/office/?gonearest=",this.groupMenuInited=!1,this.desktopInited=!1,m.resizeInited=!1,this.initialSubmenuContents=this.container.querySelector(".fhr_botContainer").innerHTML,require.config({waitSeconds:0,paths:{text:i.path+"/js/text"}}),this.initMobile(this.container),this.initDesktop(this.container),this.checkUserAuthorization(),this.initPopUpListners(),this.initNearestOfficeLink(),this.checkResolution();var t=throttle(this.checkResolution.bind(this),500);window.addEventListener("resize",t),this.initCityChooser(),$(isLoyalClient),$(addPortfelLinkTime)},this.checkResolution=function(){window.innerWidth<1025?this.mobile=!0:this.mobile=!1},this.checkUserAuthorization=function(){},this.initPopUpClickHandler=function(n){n&&n.addEventListener("click",function(e){if(!e.target.closest(".popUpContainer")&&!e.target.closest(".fhr-auth-menu")){var t=n.dataset.for,i=m.container.querySelector(".activePopUp"),o=m.container.querySelector("."+t);if(e.stopPropagation(),i){if(o.classList.contains("activePopUp"))return void m.closePopUp();m.closePopUp()}m.popUpCaller=n,m.popUpCaller.classList.add("activePopUp"),m.popUp=o,m.popUp.classList.add("activePopUp"),setTimeout(function(){m.popUp.classList.add("animatePopUp")},0),m.mobile&&(document.querySelector(".fhr_mobileWrapper").classList.add("show"),setMobileMenuScrollHeight(),bodyScrollLock.disableBodyScroll(o)),e.stopPropagation(),document.addEventListener("click",m._onDocumentClick)}})},this.closePopUp=function(){m.popUp.classList.remove("animatePopUp");var e=m.popUpCaller,t=m.popUp;m.mobile?(m.animating=!0,setTimeout(function(){e.classList.remove("activePopUp"),t.classList.remove("activePopUp"),m.popUp.classList.contains("activePopUp")||document.querySelector(".fhr_mobileWrapper").classList.remove("show")},300),bodyScrollLock.enableBodyScroll(m.popUp)):(e.classList.remove("activePopUp"),t.classList.remove("activePopUp")),document.removeEventListener("click",this._onDocumentClick)},this.hideCallTogglers=function(){Array.prototype.forEach.call(document.querySelectorAll(".js_call_toggle_list_item"),function(e){e.style.display="none"})},this.checkOverflowTopMenu=function(){m.desktopContainer.querySelector(".fhr_topLeft").classList.add("fhr_overflowActive")},this.getCookie=function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},this.initPopUpListners=function(){for(var e=this.container.querySelectorAll(".js_open_popup"),t=0;t<e.length;t++)this.initPopUpClickHandler(e[t])},this.initMobile=function(){this.initAccordeonClickHandler(document.querySelector(".js-mobile-site-menu")),this.initSubMenuMobile(document.querySelector(".fhr_mobileBotMenu .fhr_botMenu")),this.initPopUpClosers()},this.initDesktop=function(){var e={forex:/(forex.finam.ru)/,bank:/(finambank.ru)/,fdu:/(fdu.ru)/},t=window.location.hostname,i=this.container.querySelector(".fhr_botMenu"),o=null;switch(!0){case e.bank.test(t):o="bank";break;case e.forex.test(t):o="forex";break;case e.fdu.test(t):o="management"}Array.prototype.slice.call(i.children||[],0).forEach(function(e){e.dataset.for===o&&e.classList.add("fhr_item_active")}),this.initSubMenu(i);var n=document.getElementsByClassName("fhr_topMenu")[0];n&&(n.cssText="padding-bottom: 0;")},this.initPopUpClosers=function(){for(var e=this.container.querySelectorAll(".js_close_popup"),t=0;t<e.length;t++)m.initCloser(e[t])},this.initCloser=function(e){e.addEventListener("click",m.closePopUp)},this.initSubMenuMobile=function(e){var t=e.querySelectorAll(".fhr_botMenuItem"),i=Array.prototype.slice.call(t).filter(function(e){var t=e.dataset.for;if(t&&"fhr_topMenu"!==t)return!0}),o=0;function n(){o<i.length-1?o++:m._initAccordion(!0)}setMobileMenuScrollHeight(),i.forEach(function(e){var t="text!"+m.staticaPath+"js/templates/"+e.dataset.for+".html";this.renderSubMenuMobile(t,e,n)}.bind(this))},this.initSubMenu=function(e){var t=e.querySelectorAll(".fhr_item");m.itemsNeedToInit=t.length;for(var i=0;i<t.length;i++){var o=t[i].dataset.for,n="text!"+m.staticaPath+"js/templates/"+o+".html";o&&"fhr_topMenu"!==o&&this.renderSubMenu(n,t[i])}},this.initAccordeonClickHandler=function(o){o._clickHandlerAdded||(o._clickHandlerAdded=!0,o.addEventListener("click",function(e){if(e.target.parentNode.classList.contains("fhr_item")){var t=o.dataset.for,i=m.mobileContainer.querySelector("."+t);if(i.classList.contains("activeAccordeon"))return i.classList.remove("activeAccordeon"),void o.classList.remove("activeAccord");o.classList.add("activeAccord"),i.classList.add("activeAccordeon")}}))},this.initCityChooser=function(){var t=this._initCityChooserBody.bind(m);m.filialsList?t(m.filialsList):this.fetchFilials(this.filialsUrl,function(e){m.filialsList=e,t(e)})},this._initCityChooserBody=function(e){for(var t=m.container.querySelectorAll(".callChat"),i=0;i<t.length;++i)t[i].addEventListener("click",function(e){e.preventDefault(),window.open(this.getAttribute("href"),"hello","width=400,height=560")});var o=e||window.cities,n=this.container.querySelector(".fhr-city-menu");this.container.querySelector(".fhr-city-menu .fi-cross").addEventListener("click",function(){setTimeout(function(){m.popUpSelect.classList.remove("activePopUp"),delete m.popUpSelect},0)});var r=this.container.querySelector(".fhr_mobileCityCaller"),s=this.container.querySelector(".fhr_callInfo-desktop"),c=this.container.querySelector(".fhr_city-popup");c&&(r.addEventListener("click",m.initSelect),m.initPopUpClickHandler(c)),m.initPopUpClickHandler(r),m.initPopUpClickHandler(s);var a=Math.ceil(o.length/3),l=document.createElement("ul"),u=0,d=window.location.search.match(/AgencyBackofficeID=(\d{1,9})/i);d=d&&d[1];var p=Number(m.getCookie("selectedAgency"))||1;o.some(function(e){return e.id===p})||(p=1);for(i=0;i<o.length;i++){a==u&&(u=0,l=document.createElement("ul")),u++;var f=document.createElement("li"),h=document.createElement("span");h.innerText=o[i].name,m.initCityClick(o[i],f,i),f.appendChild(h),p!=o[i].id||d||m.setActiveCity(o[i]),d&&d==o[i].agencyGlobalId&&(m.setActiveCity(o[i]),m.setCookie("selectedAgency",o[i].id,{expires:2592e3,path:"/"})),l.appendChild(f),n.appendChild(l)}},this.initCityClick=function(e,t,i){t.addEventListener("click",function(){m.setActiveCity(e),m.setCookie("selectedAgency",e.id,{expires:2592e3,path:"/"}),m.mobile||m.closePopUp()})},this.initNearestOfficeLink=function(){var e=document.querySelectorAll("a.js-fhr-nearest-office-link");Array.prototype.forEach.call(e,function(e){navigator.geolocation&&e&&(e.parentElement.style.display="block",e.addEventListener("click",function(){m._redirectToNearestOffice()}))})},this._redirectToNearestOffice=function(){var o=this.nearestUrl||"/about/office/?gonearest=";function t(e){var t=e&&e.coords,i=t?t.longitude.toFixed(4)+","+t.latitude.toFixed(4):"";location.href=o+i}navigator.geolocation.getCurrentPosition(t,function(e){console.log(e.message),t()})},this.initSelect=function(){var e=this.dataset.for;m.popUpSelect=m.container.querySelector("."+e);var t=m.popUpSelect.querySelectorAll("li span");m.popUpSelect.classList.add("activePopUp");for(var i=0;i<t.length;i++)t[i].addEventListener("click",function(){m.popUpSelect&&(m.popUpSelect.classList.remove("activePopUp"),delete m.popUpSelect)})},this.renderSubMenu=function(e,i){require([e],function(e){var t=document.createElement("div");t.classList.add("popUpContainer"),t.innerHTML=" ",t.innerHTML=e,i.appendChild(t),m.initPopUpClickHandler(i),m.itemsNeedToInit--,0===m.itemsNeedToInit&&(m._initAccordion(),m.MasterForm())},function(e){console.debug(e)})},this.renderSubMenuMobile=function(e,i,o){require([e],function(e){var t=document.createElement("div");t.classList.add("popUpContainer"),t.innerHTML=" ",t.innerHTML=e,i.appendChild(t),m.initAccordeonClickHandler(i),o()},function(e){console.debug(e)})},this.setActiveCity=function(e){for(var t=e.tel.replace(/\(|\)|-| /gi,""),i=m.container.querySelectorAll(".fhr_city"),o=0;o<i.length;++o)i[o].innerText=e.name,i[o].setAttribute("title",e.name);var n=m.container.querySelectorAll(".fhr_phone");for(o=0;o<n.length;++o)n[o].innerText=e.tel,n[o].setAttribute("href","tel:"+t)},this.setCookie=function(e,t,i){var o=(i=i||{}).expires;if("number"==typeof o&&o){var n=new Date;n.setTime(n.getTime()+1e3*o),o=i.expires=n}o&&o.toUTCString&&(i.expires=o.toUTCString());var r=e+"="+(t=encodeURIComponent(t));for(var s in i){r+="; "+s;var c=i[s];!0!==c&&(r+="="+c)}document.cookie=r},this._initAccordion=function(e){var t="fhr-accordion",i=(e?".fhr_mobile ":".fhr_desktop ")+"."+t,o=(e?".fhr_mobile ":".fhr_desktop ")+".fhr-accordion__trigger",n=document.querySelectorAll(i),r=document.querySelectorAll(o);if(e)for(var s=0;s<n.length;s++){n[s].classList.add(t+"_open"),n[s].querySelector(".fa.fa-angle-down")&&(n[s].querySelector(".fa").classList.remove("fa-angle-down"),n[s].querySelector(".fa").classList.add("fa-angle-up"))}for(var c=0;c<n.length;c++)n[c].addEventListener("click",function(e){e.stopPropagation()});e||document.querySelector(".js_call_toggle-cont")&&document.querySelector(".js_call_toggle").addEventListener("click",function(){document.querySelector(".js_call_toggle-cont").classList.toggle("js_call_toggle-show")});for(c=0;c<r.length;c++)r[c].addEventListener("click",function(e){m.toggleAccordion(e)})},this.toggleAccordion=function(e){var t=e.currentTarget.parentNode,i=t.querySelector(".fa");t.classList.toggle("fhr-accordion_open"),i&&(i.classList.toggle("fa-angle-down"),i.classList.toggle("fa-angle-up"))},this._onDocumentClick=function(e){m.popUp.contains(e.target)&&!e.target.closest(".js-close-popup")||m.popUpSelect||m.closePopUp()},this.MasterForm=function(){var i=this;this.sorterAge,this.sorterInvest,this.sorterRisk,this.sorterResult;for(var e=document.querySelectorAll(".master__sorter__block"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.stopImmediatePropagation();var t=this.parentNode.querySelector(".master__sorter__list");t.classList.contains("active")?t.classList.remove("active"):(i.active&&i.active.classList.remove("active"),i.active=t,i.active.classList.add("active"))});var o=document.querySelectorAll(".master__sorter__list li"),n=function e(t,i,o){var n=t.parentNode;n.classList.contains(i)?n.querySelector(".master__sorter__title").innerText=o:e(n,i,o)};for(t=0;t<o.length;t++)o[t].addEventListener("click",function(){var e=this.innerText;i.active.classList.remove("active"),this.dataset.age&&(i.sorterAge=this.dataset.age),this.dataset.invest&&(i.sorterInvest=this.dataset.invest),this.dataset.risk&&(i.sorterRisk=this.dataset.risk),i.sorterAge&&i.sorterInvest&&i.sorterRisk&&document.querySelector(".master__button").classList.add("master__button_active"),n(this,"master__sorter__container",e),document.querySelector(".master__button").addEventListener("click",function(){i.sorterAge&&i.sorterInvest&&i.sorterRisk&&(i.sorterResult="master="+i.sorterAge+i.sorterInvest+i.sorterRisk,window.location.href="//www.finam.ru/services/promo000a1/?"+i.sorterResult+"#services")})})},this.fetchFilials=function(e,i){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="json",t.onload=function(e){var t=(isJsonString(this.response)?JSON.parse(this.response):this.response).data.Filials;t&&i(t)},t.send()}};function isJsonString(e){try{JSON.parse(e)}catch(e){return!1}return!0}function setMobileMenuScrollHeight(){var e=getElementOffset(document.querySelector(".fhr_mobile"));document.querySelector(".fhr_mobileSlideMenu").style.minHeight=window.innerHeight-e.viewportTop+"px";var t=document.querySelector(".fhr_callMenuMobile");if(t){var i=getElementOffset(t);t.style.maxHeight=window.innerHeight-i.top+"px"}}function getElementOffset(e){var t=e.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+o,left:t.left+i,viewportTop:t.top,viewportLeft:t.left}}function isLoyalClient(){Finam&&Finam.currentUserInfo&&Finam.currentUserInfo.loyality&&Finam.currentUserInfo.loyality.status&&$(".js-header-loyality").removeClass("d-none")}function throttle(t,i){var o,n,r=!1;return function e(){if(r)return o=arguments,void(n=this);t.apply(this,arguments),r=!0,setTimeout(function(){r=!1,o&&(e.apply(n,o),o=n=null)},i)}}function addPortfelLinkTime(){var e=$(".js-portfel-link"),t=e.attr("href"),i=$.now();e.attr("href",t+"?t="+i)}
//# sourceMappingURL=finam-ui-header.min.js.map
