window.WT=window.WT||{},window.WT.userMetrics=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(11),o=r(12),i=r(3),s=r(13);e.exports=function(e){return n(e)||o(e)||i(e)||s()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(4);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function r(t){return e.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,r(t)}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(8),o=r(9),i=r(3),s=r(10);e.exports=function(e,t){return n(e)||o(e,t)||i(e,t)||s()},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){e.exports=r(14)},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],s=!0,u=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(u)throw o}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){var n=r(4);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,r){"use strict";r.r(t),r.d(t,"userMetrics",(function(){return k}));var n=r(5),o=r.n(n),i=r(6),s=r.n(i),u=r(2),a=r.n(u),l=r(0),c=r.n(l),f=r(1),d=r.n(f),p=1,h=2,g=4,_=8,v=255,y=function(){function e(t,r,n){c()(this,e),this.name="",this.level=0,this.isEnabled=!1,this.name=t,this.isEnabled=!!r,this.level=n||v}return d()(e,[{key:"_getPrefix",value:function(){return this.name?"".concat(this.name,":"):""}},{key:"_isLevel",value:function(e){return!!(this.level&e)}},{key:"debug",value:function(){var e;if(this.isEnabled&&this._isLevel(p)&&window.console){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).debug.apply(e,[this._getPrefix()].concat(r))}}},{key:"log",value:function(){var e;if(this.isEnabled&&this._isLevel(h)&&window.console){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).log.apply(e,[this._getPrefix()].concat(r))}}},{key:"error",value:function(){var e;if(this.isEnabled&&this._isLevel(_)&&window.console){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).error.apply(e,[this._getPrefix()].concat(r))}}},{key:"warn",value:function(){var e;if(this.isEnabled&&this._isLevel(g)&&window.console){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];(e=console).warn.apply(e,[this._getPrefix()].concat(r))}}}]),e}();function b(e){var t=!1,r=null,n=null;this.then=function(e){return new b((function(o){t?o(e(r)):n=function(){o(e(r))}}))};var o=function(e){t||(t=!0,r=e,n&&n())};setTimeout((function(){e(o)}))}var x=function(){function e(){c()(this,e),this.logger=void 0}return d()(e,[{key:"_getFullKey",value:function(e){return"wt_user_metrics_".concat(e)}},{key:"_getData",value:function(e){return localStorage.getItem(this._getFullKey(e))}},{key:"_removeData",value:function(e){return localStorage.removeItem(this._getFullKey(e))}},{key:"_saveData",value:function(e,t){try{localStorage.setItem(this._getFullKey(e),t)}catch(e){this.logger&&this.logger.error("It couldn't save date to localStorage",e)}}},{key:"isDebug",value:function(){return"enabled"===this._getData("debug")}},{key:"setDebug",value:function(e){e?this._saveData("debug","enabled"):this._removeData("debug")}},{key:"getBuid",value:function(){return this._getData("buid")}},{key:"setBuid",value:function(e){this._saveData("buid",e)}}]),e}(),w=function(){function e(t){c()(this,e),this._storage=void 0,this._storage=t}return d()(e,[{key:"setEnabled",value:function(e){this._storage.setDebug(e)}}]),e}(),m=function(){function e(t){c()(this,e),this._logger=void 0,this._logger=t}return d()(e,[{key:"_request",value:function(e,t){var r=this,n=new XMLHttpRequest;return n.open("POST","".concat("https://limex.com").concat(e)),n.setRequestHeader("Content-type","application/json; charset=utf-8"),n.withCredentials=!0,n.timeout=1e4,n.responseType="json",new b((function(o){n.addEventListener("loadend",(function(){var t=null;if(n.status<200||n.status>299?t="the ".concat(n.status," status is unexpected"):n.response&&n.response.result&&n.response.result.ok||(t="the server returned the unexpected error"),t)return r._logger.error("The API Client got the error for the '".concat(e,"' request"),t,n.response),void o(null);var i=n.response.result,s=i.extraCode,u=i.buid;s&&r._logger.log("The API request to '".concat(e,"' was successful but it got the extra result code"),s),o(u||null)})),n.addEventListener("timeout",(function(){r._logger.error("The API Client got the timeout for the '".concat(e,"' request")),o(null)})),n.send(JSON.stringify(t))}))}},{key:"sendOpenPage",value:function(e,t,r){return this._request("/ng/api/v1/internal/user-metrics/send-open-page/",{url:e,project:t,buid:r})}},{key:"sendUserEvent",value:function(e,t,r,n,o){return this._request("/ng/api/v1/internal/user-metrics/send-user-event/",{eventUrl:e,eventName:t,eventParams:r,project:n,buid:o})}},{key:"linkUser",value:function(e,t,r){return this._request("/ng/api/v1/internal/user-metrics/link-user/",{projectUserId:e,project:t,buid:r})}}]),e}(),k=new(function(){function e(){var t=this;c()(this,e),this._project="other",this._callbacksAfterUpdatedBuid=[],this.debug=void 0,this._logger=void 0,this._apiClient=void 0,this.lastOpenedPage=void 0,this._onUrlChanged=function(){t._logger.log("It detected URL changes"),t.sendCurrentPage()},this._storage=new x,this._logger=new y("WT User Metrics",!0,this._storage.isDebug()?v:_),this._storage.logger=this._logger,this._apiClient=new m(this._logger),this.debug=new w(this._storage),this._substituteHistoryApiMethods(),this._followToUrlChanges()}return d()(e,[{key:"setProject",value:function(e){this._logger.log("The project was changed to",e),this._project=e}},{key:"processCommandQueueData",value:function(e){var t=a()(e),r=s()(t,1)[0],n=o()(r);"function"===n?r(this):"string"===n?"function"==typeof this[r]?this[r].apply(this,a()(t.slice(1))):this._logger.error('The "',r,"method is unknown"):this._logger.error("It expects the first argument is string or function, but it got",n)}},{key:"migrateBuid",value:function(e){e&&this._logger.log("Migrate BUID to",e),this._updateBuidIfNeed(e)}},{key:"_followToUrlChanges",value:function(){window.addEventListener("popstate",this._onUrlChanged)}},{key:"_substituteHistoryApiMethods",value:function(){var e=this;["pushState","replaceState"].forEach((function(t){var r=window.history[t];window.history[t]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=r.apply(window.history,n);return e._onUrlChanged(),i}}))}},{key:"_updateBuidIfNeed",value:function(e){e&&(this._storage.setBuid(e),this._callbacksAfterUpdatedBuid.forEach((function(t){t(e)})),this._callbacksAfterUpdatedBuid=[])}},{key:"sendCurrentPage",value:function(){return this._logger.log("It's sending the current page"),this.sendOpenPage(e._getCurrentUrl())}},{key:"sendOpenPage",value:function(e){var t=this;return this.lastOpenedPage===e?(this._logger.log("Skip duplicated url",e),new b((function(e){return e()}))):(this.lastOpenedPage=e,this._logger.log("It's sending the open page",e),this._apiClient.sendOpenPage(e,this._project,this._storage.getBuid()).then((function(e){return t._updateBuidIfNeed(e),!!e})))}},{key:"sendUserEvent",value:function(t){for(var r=this,n=e._getCurrentUrl(),o=arguments.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=arguments[s];this._logger.log("It's sending the user event",t,"with params",i,"for page",n);var u=this._apiClient.sendUserEvent(n,t,i,this._project,this._storage.getBuid());return u.then((function(e){return r._updateBuidIfNeed(e),!!e}))}},{key:"linkUser",value:function(e,t){var r=this,n=this._storage.getBuid(),o=t||this._project;return this._logger.log("It's linking the project user",e,"with BUID",n,"and project",o),this._apiClient.linkUser(e,o,n).then((function(e){return r._updateBuidIfNeed(e),!!e}))}},{key:"getBuid",value:function(){var e=this;return new b((function(t){var r=e._storage.getBuid();r?t(r):e._callbacksAfterUpdatedBuid.push(t)}))}}],[{key:"_getCurrentUrl",value:function(){return window.location.href}}]),e}());setTimeout((function(){window.wtUserMetrics=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return k.processCommandQueueData(t)},(window.wtUserMetricsQueue||[]).forEach((function(e){return k.processCommandQueueData(e)})),delete window.wtUserMetricsQueue,k.sendCurrentPage()}))}]).userMetrics;